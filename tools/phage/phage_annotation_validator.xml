<?xml version="1.0"?>
<tool id="edu.tamu.cpt2.phage.annotation_validator" name="Phage QC" version="1.8">
    <description>validate phage annotations</description>
    <macros>
      <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <version_command>python phage_annotation_validator.py --version</version_command>
    <command detect_errors="aggressive"><![CDATA[
@GENOME_SELECTOR_PRE@

python $__tool_directory__/phage_annotation_validator.py
$gff3_data
@GENOME_SELECTOR@

--sd_min $sd_min
--sd_max $sd_max
--gap_dist $gap_dist
--overlap_dist $overlap_dist
--min_gene_length $min_gene
--reportTemplateName $report_format
--gff3 $gff3

--excessive_gap_dist $egd
--excessive_gap_divergent_dist $egdd
--user_email $__user_email__

> $output;

#if ".tex" in str($report_format):
    mv $output tmp.tex;
    docker run --rm -i --user="\$(id -u):\$(id -g)" --net=none -v \$PWD:/data blang/latex pdflatex tmp.tex &&
    mv tmp.pdf $output;
#end if
]]></command>
    <inputs>
        <expand macro="gff3_input" />
        <expand macro="genome_selector" />

        <param label="Minimum distance for SDs (bp)" name="sd_min" type="integer" value="5" />
        <param label="Maximum distance for SDs (bp)" name="sd_max" type="integer" value="15" />

        <param label="Minimum distance to call a gap (bp)" name="gap_dist" type="integer" value="45" />
        <param label="Maximum overlap distance to permit (bp)" name="overlap_dist" type="integer" value="15" />
        <param label="Minimum length of naively called ORFs in gaps (in AAs)" name="min_gene" type="integer" value="25" />

        <param label="Excessive gap distance (non-divergent, bp)" name="egd" type="integer" value="50" />
        <param label="Excessive gap distance (divergent, bp)" name="egdd" type="integer" value="200" />

        <param label="Report Format" type="select" name="report_format">
            <option value="phageqc_report_full.html" selected="True">Full Report</option>
            <option value="phageqc_report_464.html">464 Report</option>
            <option value="phageqc_report_genomea.tex">GenomeA PDF Report</option>
            <option value="phageqc_report_genomea.html">GenomeA HTML Report</option>
        </param>
    </inputs>
    <outputs>
      <data format="html" name="output"/>
      <data format="gff3" name="gff3" label="Phage QC annotation track"/>
    </outputs>
    <help><![CDATA[
**What it does**

Run CPT's Phage Annotation Validator validating the following properties:

-  Missing RBSs
-  Missing Gene Features
-  Excessive Gaps
-  Excessive Overlaps
-  Morons
-  Weird Start Codons

        ]]></help>
</tool>
