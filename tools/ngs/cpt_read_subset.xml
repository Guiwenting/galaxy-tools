<?xml version="1.0"?>
<tool id="edu.tamu.cpt.assembly.coverage_calc" name="FastQ Subset" version="1.0">
  <description>reduce results for X-fold coverage</description>
  <stdio>
    <exit_code level="fatal" range="1:"/>
  </stdio>
  <command interperter="bash"><![CDATA[cpt_read_subset.sh
"${file}"

#if $source.source_select!="file":
    ${length}
#elif:
    \$(grep -v ">" ${fasta} | wc | awk '{print $3-$1}')
#end if
${coverage} > $fastq
]]>
  </command>
  <inputs>
    <param label="FastQ Readset" name="file" type="data" format="fastq,fastqsanger"/>

    <conditional name="source">
        <param name="source_select" type="select" label="Genome Size">
            <option value="file">Obtain from fasta sequence</option>
            <option value="text">Direct Entry</option>
        </param>
        <when value="file">
            <param label="Fasta Genome File" name="fasta" type="data" format="fasta" />
        </when>
        <when value="text">
            <param label="Expected length of genome" name="length" type="integer" value="100000"/>
        </when>
    </conditional>
    <param label="Desired coverage" name="coverage" type="integer" value="100"/>
  </inputs>
  <outputs>
    <data format="fastq" name="fastq"></data>
  </outputs>
  <help><![CDATA[Subset FastQ file
=================

Reduce a FastQ file to a specific fold coverage. In phage genomics, we've
started seeing huge coverage numbers for genome sequences (>500X). These seem
to be leading to poor assemblies and mis-assemblies. We've found that reducing
the coverage to ~100X produce better assemblies.
]]>
</help>
</tool>
