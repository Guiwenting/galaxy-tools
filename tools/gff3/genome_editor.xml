<?xml version="1.0"?>
<tool id="edu.tamu.cpt.gff3.genome_editor" name="Genome Editor" version="2.1">
  <description>allows you to re-arrange a genome</description>
  <macros>
    <import>macros.xml</import>
    <import>cpt-macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command><![CDATA[
@GENOME_SELECTOR_PRE@
python $__tool_directory__/genome_editor.py

@GENOME_SELECTOR@
@INPUT_GFF@
"$new_id"

--out_fasta "$out_fasta"
--out_gff3 "$out_gff3"
--out_simpleChain "$out_chain"
--customSeqs "$custom_seqs"
--changes
#for $idx, $change in enumerate($changes):
	#if $change.input_type.input_type_select == "region":
		${change.input_type.start},${change.input_type.end},${change.input_type.revcom}
	#else
		custom${idx}
	#end if
#end for


]]></command>
	<configfiles>
		<configfile name="custom_seqs">
		<![CDATA[
#for $idx, $change in enumerate($changes):
	#if $change.input_type.input_type_select == "custom":
>custom${idx}
${change.input_type.seq}
	#end if
#end for
		]]>
		</configfile>
	</configfiles>
  <inputs>
      <expand macro="input/gff3+fasta" />
      <param label="New ID" name="new_id" type="text" help="New ID for the sequence to uniquely identify it from the previous build of the sequence. E.g. append Miro could become Miro.2 or Miro.v2 "/>
      <repeat name="changes" title="Sequence Component Selections">
		<conditional name="input_type">
			<param name="input_type_select" type="select" label="Data Source">
				<option value="region" selected="True">Region from FASTA file</option>
				<option value="custom">Custom Additional Sequence</option>
			</param>
			<when value="region">
				<param label="Start" name="start" type="integer" min="1" value="1" help="Inclusive range, 1-indexed genome. (I.e. specifying 1-2000 will include base number 1)"/>
				<param label="End" name="end" type="integer" min="1" value="1" help="Inclusive range. (I.e. specifying 1-2000 will include base number 2000)"/>
				<param label="Reverse + Complement" name="revcom" type="boolean" truevalue="-" falsevalue="+" />
			</when>
			<when value="custom">
				<param label="Custom Sequence" name="seq" type="text" help="Enter the sequence, e.g. 'ACTG'. No FASTA definition line."/>
			</when>
		</conditional>
      </repeat>
  </inputs>
  <outputs>
	<data format="gff3" name="out_gff3" label="${new_id} Features"/>
    <data format="fasta" name="out_fasta" label="${new_id}"/>
    <data format="tabular" name="out_chain" label="${new_id} Change Table"/>
  </outputs>
  <tests>
  </tests>
  <help><![CDATA[
**What it does**

Allows for "editing" of a genome. Selecting regions of a genome and stitching them together. E.g. for an input sequence like:

	>Miro
	TTAGT AATGG CTAAA

We could enter sequence component selections like:

- start: 1, end: 10, strand: +
- start: 6, end: 10, strand: +

and we would see:

	>Miro.v2
	TTAGT AATGG AATGG

(Spaces added for clarity.)

Or, if we chose to reverse + complement the last section:

- start: 1, end: 10, strand: +
- start: 6, end: 10, strand: -

And this outputs the following:

	>Miro.v2
	TTAGT AATGG CCATT

]]></help>
  <expand macro="citations" />
</tool>
